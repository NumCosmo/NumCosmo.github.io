<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Samplers comparison</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="rosenbrock_simple_files/libs/clipboard/clipboard.min.js"></script>
<script src="rosenbrock_simple_files/libs/quarto-html/quarto.js"></script>
<script src="rosenbrock_simple_files/libs/quarto-html/popper.min.js"></script>
<script src="rosenbrock_simple_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="rosenbrock_simple_files/libs/quarto-html/anchor.min.js"></script>
<link href="rosenbrock_simple_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="rosenbrock_simple_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="rosenbrock_simple_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="rosenbrock_simple_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="rosenbrock_simple_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Samplers comparison</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><strong>License</strong></p>
<p>rosenbrock_simple</p>
<p>Sun Apr 02 21:13:00 2023<br>
Copyright 2023<br>
Sandro Dias Pinto Vitenti <a href="mailto:vitenti@uel.br" class="email">vitenti@uel.br</a> ___ rosenbrock_simple<br>
Copyright (C) 2023 Sandro Dias Pinto Vitenti <a href="mailto:vitenti@uel.br" class="email">vitenti@uel.br</a></p>
<p>numcosmo is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
<p>numcosmo is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/" class="uri">http://www.gnu.org/licenses/</a>.</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numcosmo_py <span class="im">import</span> Ncm</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.animation <span class="im">import</span> FuncAnimation</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> getdist</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> getdist <span class="im">import</span> plots</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> getdist</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> getdist <span class="im">import</span> plots</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numcosmo_py.sampling.apes <span class="im">import</span> APES</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numcosmo_py.sampling.catalog <span class="im">import</span> Catalog</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numcosmo_py.plotting.tools <span class="im">import</span> set_rc_params_article</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> emcee</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zeus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="initialize-numcosmo-and-sampling-parameters" class="level3">
<h3 class="anchored" data-anchor-id="initialize-numcosmo-and-sampling-parameters">Initialize NumCosmo and sampling parameters</h3>
<p>In this notebook, we will compare the performance of three different samplers: APES, Emcee, and Zeus. To start, we will use the new and experimental Python interface for NumCosmo.</p>
<p>Next, we will define the sampling configuration. Our goal is to generate a total of 300,000 points across all three samplers, with each sampler using 300 walkers. This translates to 1000 steps on each sampler to reach our desired sample size. By comparing the performance of these three samplers using the NumCosmo Python interface, we can evaluate their respective capabilities and identify any advantages or limitations for our specific problem.</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Ncm.cfg_init()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Ncm.cfg_set_log_handler(<span class="kw">lambda</span> msg: sys.stdout.write(msg) <span class="kw">and</span> sys.stdout.flush())</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ssize <span class="op">=</span> <span class="dv">300000</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>nwalkers <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>burin_steps <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>verbose <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="probability-definition" class="level3">
<h3 class="anchored" data-anchor-id="probability-definition">Probability definition</h3>
<p>In the cell below, we will define the unnormalized Rosenbrock distribution, which is known to be a difficult distribution to sample from. The Rosenbrock distribution is often used as a benchmark for testing the performance of sampling algorithms. By using this challenging distribution, we can better understand how well the samplers perform under difficult sampling conditions.</p>
<p>We will generate a single initial sample point with random normal realizations having a mean of zero and a standard deviation of one. This initial point will be used as the starting point for each of the samplers, ensuring that they all start at the same point.</p>
<p>It’s worth noting that this initial sample point is very different from a sample from an actual Rosenbrock distribution. However, this is intentional, as we want to see how each sampler performs under challenging conditions.</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_prob(x, ivar):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> (<span class="fl">100.0</span> <span class="op">*</span> (x[<span class="dv">1</span>] <span class="op">-</span> x[<span class="dv">0</span>] <span class="op">*</span> x[<span class="dv">0</span>]) <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> (<span class="fl">1.0</span> <span class="op">-</span> x[<span class="dv">0</span>]) <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> <span class="fl">1.0e-1</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>ndim, nwalkers <span class="op">=</span> <span class="dv">2</span>, nwalkers</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>p0 <span class="op">=</span> np.random.randn(nwalkers, ndim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="runnig-numcomos-apes" class="level3">
<h3 class="anchored" data-anchor-id="runnig-numcomos-apes">Runnig NumComo’s APES</h3>
<p>In the cell below, we will run NumCosmo’s APES algorithm using the configuration defined above.</p>
<div class="cell" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sampler_apes <span class="op">=</span> APES(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    nwalkers<span class="op">=</span>nwalkers, ndim<span class="op">=</span>ndim, model<span class="op">=</span><span class="va">None</span>, log_prob<span class="op">=</span>log_prob, args<span class="op">=</span>()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>sampler_apes.run_mcmc(p0, ssize <span class="op">//</span> nwalkers)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>mcat_apes <span class="op">=</span> sampler_apes.get_catalog()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>mcat_apes.trim(burin_steps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="running-emcee" class="level3">
<h3 class="anchored" data-anchor-id="running-emcee">Running Emcee</h3>
<p>In the cell below, we will run the Emcee algorithm with the same initial point <code>p0</code> generated previously. We will generate a chain of samples using Emcee and store the resulting chain in a <code>Catalog</code> object. This will allow us to apply the same tests to all algorithms and compare their performance on an even footing.</p>
<div class="cell" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sampler_emcee <span class="op">=</span> emcee.EnsembleSampler(nwalkers, ndim, log_prob, args<span class="op">=</span>[<span class="dv">0</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>state_emcee <span class="op">=</span> sampler_emcee.run_mcmc(p0, ssize <span class="op">//</span> nwalkers)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>chain_emcee <span class="op">=</span> sampler_emcee.get_chain(flat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>log_prob_emcee <span class="op">=</span> sampler_emcee.get_log_prob(flat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>mcat_emcee <span class="op">=</span> Catalog(ndim<span class="op">=</span>ndim, nwalkers<span class="op">=</span>nwalkers, run_type<span class="op">=</span><span class="st">"EMCEE"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>mcat_emcee.add_points_m2lnp(chain_emcee, <span class="op">-</span><span class="fl">2.0</span> <span class="op">*</span> log_prob_emcee)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>mcat_emcee.trim(burin_steps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="running-zeus" class="level3">
<h3 class="anchored" data-anchor-id="running-zeus">Running Zeus</h3>
<p>In the cell below, we will run the Zeus algorithm with the same initial point <code>p0</code> generated previously. We will generate a chain of samples using Zeus and store the resulting chain in a <code>Catalog</code> object. One difference from Emcee is that Zeus output chains are not interweaved, so we need to inform the <code>Catalog</code> object of this fact to ensure that autocorrelation estimates are correct.</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sampler_zeus <span class="op">=</span> zeus.EnsembleSampler(nwalkers, ndim, log_prob, args<span class="op">=</span>[<span class="dv">0</span>], verbose<span class="op">=</span>verbose)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sampler_zeus.run_mcmc(p0, ssize <span class="op">//</span> nwalkers, progress<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>chain_zeus <span class="op">=</span> sampler_zeus.get_chain(flat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>log_prob_zeus <span class="op">=</span> sampler_zeus.get_log_prob(flat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>mcat_zeus <span class="op">=</span> Catalog(ndim<span class="op">=</span>ndim, nwalkers<span class="op">=</span>nwalkers, run_type<span class="op">=</span><span class="st">"ZEUS"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>mcat_zeus.add_points_m2lnp(chain_zeus, <span class="op">-</span><span class="fl">2.0</span> <span class="op">*</span> log_prob_zeus, interweaved<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>mcat_zeus.trim(burin_steps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="analyzing-results" class="level3">
<h3 class="anchored" data-anchor-id="analyzing-results">Analyzing results</h3>
<p>In the cell below, we will create two arrays containing the true values for the mean and standard deviation of the Rosenbrock distribution. We will then call <code>print_status</code> on each catalog to obtain the current mean, standard deviation, mean standard deviation, and autocorrelation time <span class="math inline">\(\tau\)</span>. Based on the results, we can see that APES has the lowest autocorrelation time <span class="math inline">\(\tau\)</span> for all parameters, being more than 100 times smaller than the autocorrelation time obtained by Emcee and Zeus.</p>
<p>This indicates that APES was able to explore the parameter space more efficiently and produce less correlated samples. Additionally, we can see that the mean, standard deviation and mean standard deviation obtained by all samplers are close to the true values of the Rosenbrock distribution. However, it is important to note that the Emcee and Zeus chains may not have fully converged yet, so it is possible that their mean and variance estimates, as well as their autocorrelation times, could improve with further sampling.</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> np.sqrt([<span class="fl">10.0</span>, <span class="dv">2401</span> <span class="op">/</span> <span class="dv">10</span>])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> np.array([<span class="fl">1.0</span>, <span class="fl">11.0</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>Ncm.cfg_msg_sepa()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>mcat_apes.print_status()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>Ncm.cfg_msg_sepa()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>mcat_emcee.print_status()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>Ncm.cfg_msg_sepa()</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>mcat_zeus.print_status()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#----------------------------------------------------------------------------------
# NcmMSetCatalog: Current mean:   1.9823       1.0122       10.821     
# NcmMSetCatalog: Current msd:    0.0099513    0.012989     0.089849   
# NcmMSetCatalog: Current sd:     1.9578       3.1299       14.996     
# NcmMSetCatalog: Current var:    3.8331       9.7964       224.89     
# NcmMSetCatalog: Current tau:    7.363        4.9083       10.231     
#----------------------------------------------------------------------------------
# NcmMSetCatalog: Current mean:   1.3842       0.33641      3.6291     
# NcmMSetCatalog: Current msd:    0.019304     0.08911      0.20796    
# NcmMSetCatalog: Current sd:     1.4769       1.8783       4.5712     
# NcmMSetCatalog: Current var:    2.1813       3.528        20.896     
# NcmMSetCatalog: Current tau:    48.691       641.46       589.86     
#----------------------------------------------------------------------------------
# NcmMSetCatalog: Current mean:   1.5803       0.84587      6.5381     
# NcmMSetCatalog: Current msd:    0.040327     0.065184     0.31753    
# NcmMSetCatalog: Current sd:     1.5791       2.4132       8.1679     
# NcmMSetCatalog: Current var:    2.4936       5.8236       66.715     
# NcmMSetCatalog: Current tau:    185.86       207.94       430.7      </code></pre>
</div>
</div>
</section>
<section id="comparing-the-mean-estimates" class="level3">
<h3 class="anchored" data-anchor-id="comparing-the-mean-estimates">Comparing the mean estimates</h3>
<p>Below, we compare the mean estimates obtained by each sampler and print the relative error on each estimate. As we can see, APES is the only sampler that is able to recover the true means within 1% - 2% error, while Emcee and Zeus exhibit much larger errors.</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">abs</span>(mcat_apes.get_mean() <span class="op">/</span> mean <span class="op">-</span> <span class="fl">1.0</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">abs</span>(mcat_emcee.get_mean() <span class="op">/</span> mean <span class="op">-</span> <span class="fl">1.0</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">abs</span>(mcat_zeus.get_mean() <span class="op">/</span> mean <span class="op">-</span> <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[0.01221245 0.01623903]
[0.66359399 0.67008017]
[0.15412786 0.40562504]</code></pre>
</div>
</div>
</section>
<section id="comparing-the-standard-deviation-estimates" class="level3">
<h3 class="anchored" data-anchor-id="comparing-the-standard-deviation-estimates">Comparing the standard deviation estimates</h3>
<p>Similar to the previous comparison, we now look at the relative error on the standard deviation estimates. Once again, APES performs the best among the samplers, with estimates within 1% - 4% of the true values.</p>
<div class="cell" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">abs</span>(np.sqrt(np.diagonal(mcat_apes.get_covar())) <span class="op">/</span> sigma <span class="op">-</span> <span class="fl">1.0</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">abs</span>(np.sqrt(np.diagonal(mcat_emcee.get_covar())) <span class="op">/</span> sigma <span class="op">-</span> <span class="fl">1.0</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.<span class="bu">abs</span>(np.sqrt(np.diagonal(mcat_zeus.get_covar())) <span class="op">/</span> sigma <span class="op">-</span> <span class="fl">1.0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[0.01023166 0.03219158]
[0.40602937 0.70499087]
[0.23687763 0.47287218]</code></pre>
</div>
</div>
</section>
<section id="using-getdist-on-the-chains" class="level3">
<h3 class="anchored" data-anchor-id="using-getdist-on-the-chains">Using <code>getdist</code> on the chains</h3>
<p>In this next cell, we convert the catalog of MCMC chains for each algorithm into <code>MCSamples</code> objects using the <code>getdist</code> package. This allows us to easily plot the joint and marginal posterior distributions of the parameters using the <code>getdist</code> <code>plotter</code>.</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mcs_apes <span class="op">=</span> mcat_apes.get_mcsamples(<span class="st">"APES"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mcs_emcee <span class="op">=</span> mcat_emcee.get_mcsamples(<span class="st">"EMCEE"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>mcs_zeus <span class="op">=</span> mcat_zeus.get_mcsamples(<span class="st">"ZEUS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Removed no burn in
Removed no burn in
Removed no burn in</code></pre>
</div>
</div>
</section>
<section id="corner-plot" class="level3">
<h3 class="anchored" data-anchor-id="corner-plot">Corner plot</h3>
<p>Finally, we create a joint corner plot of the samples using <code>getdist</code>. We can see that the other samplers (Emcee and Zeus) have more difficulty in sampling the tails, leading to the 1D marginals being more concentrated and reporting smaller variance. This is reflected in the larger relative errors in the mean and standard deviation estimates we saw earlier.</p>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>set_rc_params_article(ncol<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> getdist.plots.get_subplot_plotter(width_inch<span class="op">=</span>plt.rcParams[<span class="st">"figure.figsize"</span>][<span class="dv">0</span>])</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>g.settings.linewidth <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>g.triangle_plot([mcs_apes, mcs_emcee, mcs_zeus], shaded<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>auto bandwidth for theta_1 very small or failed (h=0.0005252115621235715,N_eff=105311.94481123266). Using fallback (h=0.0030285386967631644)
fine_bins_2D not large enough for optimal density: theta_0, theta_1
fine_bins_2D not large enough for optimal density: theta_0, theta_1</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="rosenbrock_simple_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>